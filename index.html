<!DOCTYPE html>
<html lang="en">

<head>
    <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>Document</title>
    <script src="//script.sheetsu.com/"></script>
    <style>

        #container {
            width: 500px;
            margin: 0 auto;
            padding: 3% 0 0 0;
            font-size: 2em;
        }

        .botones {
            margin-top: 2.5%;
            text-align: center;

        }

        button {
            width: 35%;
        }

        .application--wrap{
            min-height: 0;
        }
        
        @media only screen and (max-device-width: 480px) {
            #container {
                font-size: 2em;
                width: 95%;
            }
        }
        .list{
            display: inline;
        }
    </style>
</head>

<body>
    <div id="container">
        <v-app>
            <v-content>
                <v-container>
                    <v-form method="POST" @submit.prevent="sendForm" id="formulario">
                        <div>
                            <v-menu ref="menu" :close-on-content-click="false" v-model="menu" :nudge-right="40"
                                :return-value.sync="fecha" lazy transition="scale-transition" offset-y full-width
                                min-width="290px">
                                <v-text-field slot="activator" v-model="fecha" label="Fecha" prepend-icon="event"
                                    readonly name="fecha"></v-text-field>
                                <v-date-picker v-model="fecha" no-title scrollable>
                                    <v-spacer></v-spacer>
                                    <v-btn flat color="primary" @click="menu = false">Cancel</v-btn>
                                    <v-btn flat color="primary" @click="$refs.menu.save(fecha)">OK</v-btn>
                                </v-date-picker>
                            </v-menu>
                        </div>
                        <div>
                            <v-text-field label="Motivo" v-model="motivo" name="motivo"></v-text-field>
                        </div>
                        <div>
                            <v-text-field type="number" v-model="monto" label="Monto" name="monto"></v-text-field>
                        </div>

                        <div class="list" v-for="usr in usuarios">
                            <v-chip v-bind:for="usr.Usuario">
                                <input type="radio" v-bind:id="usr.Usuario" v-bind:value="usr.Usuario" name="usuario" />
                                <label v-bind:for="usr.Usuario">{{usr.Usuario}}</label>
                            </v-chip>
                        </div>
                        <!--<div>
                            <v-subheader>Categorias (Opcional)</v-subheader>
                            <li v-for="cat in categorias">
                                <v-chip close>{{cat.Categorias}}</v-chip>
                            </li>
                        </div>-->
                        <div class="botones">
                            <v-btn color="primary" @click="sendForm">Enviar</v-btn>
                        </div>
                    </v-form>

                    <v-alert v-model="alert.estado" v-if="alert.estado === 'exito'" dismissible type="success">
                        {{alert.mensaje}}
                    </v-alert>
                    <v-alert v-model="alert.estado" v-if="alert.estado === 'error'" dismissible type="error">
                        {{alert.mensaje}}
                    </v-alert>

                </v-container>
            </v-content>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
    <script>
        const url = 'https://script.google.com/macros/s/AKfycbx4Z4TRWnH_S1lK9eBRcsf0wD9TWnRqvQmFfJXln9hawxs1d7uX/exec';
        var app = new Vue({
            el: '#container',
            data: {
                fecha: new Date().toJSON().slice(0, 10),
                motivo: '',
                monto: '',
                usuarios: [],
                categorias: [],
                menu: false,
                alert: { estado: '', mensaje: '' },
                value: ["a", "b", "c"]
            },
            created() {
                this.fetchData()
            },
            methods: {
                sendForm() {
                    axios.post(url,
                        new FormData(document.forms["formulario"]),
                        {
                            headers: {
                                'Content-type': 'application/x-www-form-urlencoded',
                            }
                        }).then(response => {
                            this.success();
                            this.alert.estado = "exito";
                            this.alert.mensaje = 'Se agrego un nuevo gasto!'
                        })
                        .catch(error => {
                            console.log(error);
                            this.alert.estado = 'error';
                            this.alert.mensaje = 'Ocurrio un error ver log :('

                        });
                },
                success() {
                    this.motivo = '',
                        this.monto = '',
                        this.usuario = '',
                        this.fecha = new Date().toJSON().slice(0, 10)
                },
                fetchData() {
                    var config = localStorage.getItem('config');
                    console.log(config)
                    if ( config != null) {
                        this.categorias = JSON.parse(config)
                        this.usuarios = JSON.parse(config)
                    } else {
                        Sheetsu.read("https://sheetsu.com/apis/v1.0su/4449fd87dc78", {}).then((data, err) => {
                            localStorage.setItem('config', JSON.stringify(data));
                            this.categorias = data
                            this.usuarios = data
                        });
                    }
                }
            }

        })

    </script>
</body>

</html>